## 简介

## 1. 大气的渲染
> Ray-marching方法，解析模型，预计算LUT三种

为了渲染大气的效果，我们需要考虑两种主要组成部分。首先，我们需要模拟阳光与空气粒子的作用，这形成了和波长相关的Rayleigh散射，使天空具有颜色并且有一层薄雾，这层薄雾又称为“空气透视”。其次，我们需要模拟阳光与近地面较大粒子的作用，这些粒子的聚集情况受天气和污染情况等因素影响。这形成了和波长无关的Mie散射，使得太阳附近形成一圈明亮的光晕，当粒子较浓时该现象更加明显。

首个基于物理的大气渲染模型是从太空中对地球和大气的单次散射进行渲染（##1285）。O'Neil提出了使用ray-marching渲染大气的方法，在太空中和地面上能以相同的方法进行渲染。该方法中对于Rayleigh散射和Mie散射的积分由于需要进行大量的ray-marching，是对天空穹顶逐顶点计算的。而相函数由于在视觉上较高频，则逐像素进行计算，这使得外观更加平滑，并且掩盖了逐顶点插值的天空几何。为了改善性能，可以将散射的计算结果存储在贴图中，分布在多帧中进行计算，其代价是会导致更新上的延迟（##1871）。

此外存在一种解析的方法，从测量得到的天空radiance或路径追踪生成的reference图像来拟合得到数学模型，其输入参数相比参与介质的参数来说更少。例如在Mie散射中使用一个浑浊系数代替$\sigma_s$和$\sigma_t$系数用来表示粒子的分布情况。Preetham等人（##1443）提出了使用一个浑浊系数和太阳倾角来参数化天空个方向radiance的模型，随后该模型被加入了xxx（##778）这些解析模型计算起来很快，然而它们只能渲染地面视角的天空，并且参数不能用来模拟其他大气也不能实现特定的艺术效果。

另一种渲染天空的方法是假设地球是一个完全的球体，被一层非均匀参与介质组成的大气环绕，具体的构成可以参见（##203）和（##743）。有了这些假设后，可以将透射率和散射项关于一系列参数进行预计算，预计算表的变量包括视点的海拔$r$、视线向量与竖直方向的夹角余弦值$\mu_v$、太阳方向向量与竖直方向的夹角余弦值$\mu_s$，视线向量与太阳方向向量的水平夹角$\nu$。例如，透射率可以由$r$和$\mu_v$进行参数化，将预计算结果储存在一张二维LUT $T_{lut}$中。Bruneton和Neyret（##203）介绍了一种散射项进行预计算的方法，参数为先前介绍的四个参数，结果储存在四维LUT $S_{lut}$中。该方法中也介绍了如何使用$S_{lut}$进行迭代求解得到多重散射的结果，然而该方法在地平线处可能会有artifact。Yusov(##1957)提出了一种改进的变换，同时忽略$\nu$将LUT降到了三维，作为代价大气不能透射阴影，这种三维的LUT在寒霜引擎中有应用。当天空的参数改变时，LUT需要重新计算，因此为了提升计算速度，在预计算LUT时可以将昂贵的ray-marching替换为近似的积分，同时可以将计算任务分布在多帧之间。（还有一点优化，关于per-voxel和per-pixel的）

## 云的渲染
一个经典的渲染云的方法是使用全景环境贴图，使用alpha混合合成到天空上面，对于静态天空来说效果尚可，然而其不能改变云的形状和光照情况。
### 基于粒子的渲染
（13节使用billboard和粒子渲染的云）
另一种基于粒子渲染的方法由Yusov提出，该方法中每个粒子使用了一张四维LUT，使得每个粒子的quad中能够根据阳光方向和视线方向计算散射光和透射率。

在基于粒子渲染方法中，经常会发生离散和突然出现的artifact，特别是视点围绕云朵旋转时。这些artifact可以通过改变混合方式避免，称为考虑体积（volume-aware）的混合，通过使用“Rasterizer Order Views”这一最新的GPU特性（用于次序无关的半透明绘制，OIT）实现。考虑体积的混合会在一个framebuffer中储存n个最近粒子的深度，在绘制粒子时使用这些深度来实现确定性的（deterministic）混合。

### 基于参与介质的渲染
我们可以将每朵云作为单独的形状进行渲染。Bouthors等人（##184）提出了一种使用mesh作为整体形状，同时使用一张hypertexture（##1371）（WTF）记录表面下一定深度内细节来渲染云的方法。使用这种表示方法，在云的边缘可以使用ray-marching来得到细节，同时云的内部可以作为均匀介质进行处理。具体的渲染方式可以使用先前

## 参考文献：

[1] Tomas Akenine-Mller, Eric Haines, and Naty Hoffman. 2018. Real-Time Rendering, Fourth Edition (4th. ed.). A. K. Peters, Ltd., USA.

原论文引用，后续补上